---
title: "The Effects of Branded Coffee on Preceived Taste Satisfaction"
author: "Amy Zhang, Chris John, Jenna Farac, Simran Gill"
date: "2024-11-27"
output:
  pdf_document: default
  html_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```



```{r reading data}
library(data.table)
library(gridExtra)
library(stargazer)
library(ggplot2)
library(lmtest)
library(dplyr) 
library(car)

set.seed(123)

control <- read.csv("Coffee Survey Control (Responses) - Form Responses 1.csv") 
treatment <- read.csv("Coffee Survey Group II (Responses) - Form Responses 1.csv")

# rename column names for control
colnames(control) <- c('timestamp', 'good_and_gather_score', 'chameleon_score', 'age', 'gender','how_often_drink_coffee', 'hot_or_cold', 'sweet_or_not_sweet', 'good_and_gather_awareness','chameleon_awareness', 'medical_condition', 'name')
# rename column names for treatment
colnames(treatment) <- c('timestamp', 'name','good_and_gather_score', 'chameleon_score', 'age', 'gender','how_often_drink_coffee', 'hot_or_cold', 'sweet_or_not_sweet', 'medical_condition','good_and_gather_awareness','chameleon_awareness')
# reorder column names for treatment
treatment <- treatment[, c('timestamp', 'good_and_gather_score', 'chameleon_score', 'age', 'gender','how_often_drink_coffee', 'hot_or_cold', 'sweet_or_not_sweet', 'good_and_gather_awareness','chameleon_awareness', 'medical_condition', 'name')]

#--- Control ----

control$treatment <- 0
control$age <- as.integer(control$age)

# re-labeling gender
control <- control %>%
  mutate(gender = case_when(
    gender == "F" ~ "Female",
    gender == "M" ~ "Male",
    TRUE ~ "Unknown"
  ))

# removing rows where age is null
control<- control %>%
  filter(!is.na(age))

#--- Treatment ----

treatment$treatment <- 1
treatment$age <- as.integer(treatment$age)

# re-labeling gender
treatment <- treatment %>%
  mutate(gender = case_when(
    gender == "F" ~ "Female",
    gender == "M" ~ "Male",
    TRUE ~ "Unknown"
  ))

# removing rows where age is null
treatment<- treatment %>%
  filter(!is.na(age))

```
## Balancing Control and Treatment
There are more participants in Control than in Treatment groups. To help create balance between the two groups, will perform random sampling to match the size of the treatment group.

```{r }
print("Before Random Sampling:")
cat("Control size:", nrow(control))
cat("\nTreatment size:", nrow(treatment))

# selecting smaller group size
n_control <- nrow(control)
min_size <- min(n_control, nrow(treatment))

# random sampling the control group 
control <- control[sample(1:n_control, min_size), ]

# combined data 
d <- rbind(control, treatment)
table(d$treatment)

```
## Organizing the rest of the data from dataset "d"

```{r }

# creating age groups
d$age_group <- cut(d$age,
                   breaks = c(0, 20, 30, 40, 50, Inf),
                   labels = c("Under 20", "20-30", "31-40", "41-50", "Over 50"),
                   right = FALSE)


# Convert how_often_drink_coffee to integer by factoring 
d$how_often_drink_coffee <- factor(d$how_often_drink_coffee,
                                   levels = c("Never", 
                                              "Occasionally (up to 1 time a week)", 
                                              "Sometimes (a few times a week)", 
                                              "Often (almost every day)", 
                                              "Every day"))

# yes/no flag for if the participant is aware of the coffee brand at all
d$chameleon_awareness_flag <- ifelse(d$chameleon_awareness == "No", 0, 1)
d$good_and_gather_awareness_flag <- ifelse(d$good_and_gather_awareness == "No", 0, 1)

cat("\nNumber of Rows after cleaning:",nrow(d),"\n")

str(d)
```
 

## Exploratory Data Analysis



```{r box plot for age}
# box plot for age by treatment and control

boxplot(d$age, control$age, treatment$age,
        names = c("Total", "Control", "Treatment"),
        main = "Box Plots for Control and Treatment",
        ylab = "Age",
        col = c("#D8A7FF", "lightblue", "lightgreen"),
        border = "black")
```
```{r }
cat("Number of Rows for Treatment Group:", sum(d$treatment == 1))
cat("\nNumber of Rows for Control Group:", sum(d$treatment == 0))
```

```{r treatment by age group}

ggplot(d, aes(x = treatment, fill = age_group)) +
  geom_bar(position = "stack") +
  labs(title = "Age Group by Control and Treatment", x = "Age Group", y = "Count") +
  scale_fill_manual(values = c("#065143", "#129490", "#70B77E", "#E0A890", "#CE1483"))  +
  theme_minimal()
```

```{r brand awarenenss chameleon}

ggplot(d, aes(x = treatment, fill = chameleon_awareness)) +
  geom_bar(position = "stack") +
  labs(title = "Chameleon Awareness by Control and Treatment", x = "chameleon_awareness", y = "Count") +
  scale_fill_manual(values = c("#70D6FF", "#FF70A6", "#FF9770", "#FFD670")) +
  theme_minimal()
```
```{r brand awareness good and gather}

ggplot(d, aes(x = treatment, fill = good_and_gather_awareness)) +
  geom_bar(position = "stack") +
  labs(title = "Good &Gather Awareness by Control and Treatment", x = "good_and_gather_awareness", y = "Count") +
  scale_fill_manual(values = c("#70D6FF", "#FF70A6", "#FF9770", "#FFD670")) +
  theme_minimal()
```


```{r Gender}

### Control Group Gender ###
control_gender_counts <- control %>%
  group_by(gender) %>%
  tally() %>%
  mutate(percentage = n / sum(n) * 100)

control_pie <- ggplot(control_gender_counts, aes(x = "", y = n, fill = gender)) +
  geom_bar(stat = "identity", width = 1) +  
  coord_polar(theta = "y") + 
  geom_text(aes(label = paste0(round(percentage, 1), "%")), 
            position = position_stack(vjust = 0.5)) +
  labs(title = "Gender Distribution for Control Group") +
  scale_fill_manual(values = c("lightpink", "lightblue", "purple")) + 
  theme_void()  

### Treatment Group Gender ###
treatment_gender_counts <- treatment %>%
  group_by(gender) %>%
  tally() %>%
  mutate(percentage = n / sum(n) * 100)

treatment_pie <- ggplot(treatment_gender_counts, aes(x = "", y = n, fill = gender)) +
  geom_bar(stat = "identity", width = 1) +  
  coord_polar(theta = "y") + 
  geom_text(aes(label = paste0(round(percentage, 1), "%")), 
            position = position_stack(vjust = 0.5)) +
  labs(title = "Gender Distribution for Treatment Group") +
  scale_fill_manual(values = c("lightpink", "lightblue", "purple")) + 
  theme_void()

grid.arrange(control_pie, treatment_pie, ncol = 2)
```

##  Simple Average Treatment Effect 

```{r }
ate_good_and_gather <- mean(d$good_and_gather_score[d$treatment == 1], na.rm = TRUE) -
                       mean(d$good_and_gather_score[d$treatment == 0], na.rm = TRUE)
cat("ATE Good & Gather:", ate_good_and_gather)
     
ate_chameleon <- mean(d$chameleon_score[d$treatment == 1], na.rm = TRUE) -
                       mean(d$chameleon_score[d$treatment == 0], na.rm = TRUE)
cat("\nATE Chameleon:", ate_chameleon)

```
## Average Treatment Effect using Linear Regression 

```{r Good & Gather - Average Treatment Effect }
# Basic Linear regression to estimate ATE
model_gg <- lm(good_and_gather_score ~ treatment, data=d)
ate_regression <- coef(model_gg)["treatment"]
print(ate_regression)

summary(model_gg)

```
```{r Chameleon - Average Treatment Effect }
# Basic Linear regression to estimate ATE
model_c <- lm(chameleon_score ~ treatment, data=d)
ate_regression <- coef(model_c)["treatment"]
print(ate_regression)

summary(model_c)

```
# ATE Adjusted for Covariates 

c('timestamp', 'good_and_gather_score', 'chameleon_score', 'age', 'gender','how_often_drink_coffee', 'hot_or_cold', 'sweet_or_not_sweet', 'good_and_gather_awareness','chameleon_awareness', 'medical_condition', 'name')

```{r Good & Gather Covariates }
model_gg_covariates <- lm(good_and_gather_score ~ treatment + log(age) + gender + chameleon_awareness,  data = d)

ate_with_covariates <- coef(model_gg_covariates)["treatment"]
print(ate_with_covariates)

summary(model_gg_covariates)

```


```{r }
vif(model_gg_covariates)
```

```{r Good&Gather ANOVA}
model_gg_covariates_v2 <- lm(good_and_gather_score ~ treatment + gender + log(age) + chameleon_awareness + good_and_gather_awareness,  data = d)

anova(model_gg_covariates , model_gg_covariates_v2)

```



**Interpretation** We tested multiple covariates to see if we can improve the regression model for Good&Gather Score. The main covariates we see has a positive impact is how a participate views the Chameleon brand and age group. 

When it comes to the Chameleon, even though the participants has a negative view of Chameleon coffee as a brand, they are still likely to score Good & Gather -1.8285 after treatment is provided. The p-value for Chameleon awareness is 0.0561, which means this variable is marginally significant. 

We also wanted to test if adding Good&Gather brand awareness as a variable to model has an significant effect to the model. From the ANOVA test we can see that the p-value is 0.5600 which is greater than 0.05. This indicated Good&Gather brand awareness has no statistically significant impact on scoring the coffee.


```{r }
stargazer(model_gg, model_gg_covariates, 
          type = "latex",   # Use "html" for HTML output or "latex" for LaTeX
          title = "Regression Results for Good and Gather Score", 
          covariate.labels = c("Treatment", "log(Age)", "Gender", 
                               "Chameleon Awareness (Negative)", 
                               "Chameleon Awareness (Neutral)", 
                               "Chameleon Awareness (Positive)"),
          star.cutoffs = c(0.10, 0.05, 0.01, 0.001),   # Significance stars
          report = "vc*p")  # Optional: Save output to a text file
```

\begin{table}[!htbp] \centering 
  \caption{Regression Results for Good and Gather Score} 
  \label{} 
\begin{tabular}{@{\extracolsep{5pt}}lcc} 
\\[-1.8ex]\hline 
\hline \\[-1.8ex] 
 & \multicolumn{2}{c}{\textit{Dependent variable:}} \\ 
\cline{2-3} 
\\[-1.8ex] & \multicolumn{2}{c}{good\_and\_gather\_score} \\ 
\\[-1.8ex] & (1) & (2)\\ 
\hline \\[-1.8ex] 
 Treatment & $-$0.436 & $-$0.669$^{**}$ \\ 
  & p = 0.188 & p = 0.035 \\ 
  & & \\ 
 log(Age) &  & 1.454$^{***}$ \\ 
  &  & p = 0.004 \\ 
  & & \\ 
 Gender &  & 0.442 \\ 
  &  & p = 0.144 \\ 
  & & \\ 
 Chameleon Awareness (Negative) &  & $-$1.973$^{**}$ \\ 
  &  & p = 0.043 \\ 
  & & \\ 
 Chameleon Awareness (Neutral) &  & 0.914$^{*}$ \\ 
  &  & p = 0.079 \\ 
  & & \\ 
 Chameleon Awareness (Positive) &  & $-$0.692 \\ 
  &  & p = 0.106 \\ 
  & & \\ 
 Constant & 4.051$^{****}$ & $-$0.955 \\ 
  & p = 0.000 & p = 0.573 \\ 
  & & \\ 
\hline \\[-1.8ex] 
Observations & 78 & 78 \\ 
R$^{2}$ & 0.023 & 0.255 \\ 
Adjusted R$^{2}$ & 0.010 & 0.192 \\ 
Residual Std. Error & 1.447 (df = 76) & 1.307 (df = 71) \\ 
F Statistic & 1.770 (df = 1; 76) & 4.057$^{***}$ (df = 6; 71) \\ 
\hline 
\hline \\[-1.8ex] 
\textit{Note:}  & \multicolumn{2}{r}{$^{*}$p$<$0.1; $^{**}$p$<$0.05; $^{***}$p$<$0.01} \\ 
\end{tabular} 
\end{table} 


```{r Chameleon Covariates }
model_c_covariates <- lm(chameleon_score ~ treatment + log(age) + gender + chameleon_awareness ,  data = d)

ate_with_covariates <- coef(model_c_covariates)["treatment"]
print(ate_with_covariates)

summary(model_c_covariates)

```
```{r Chameleon ANOVA}
model_c_covariates_v2 <- lm(chameleon_score ~ treatment + log(age) + gender + chameleon_awareness + good_and_gather_awareness,  data = d)

anova(model_c_covariates , model_c_covariates_v2)

```
```{r }
stargazer(model_c, model_c_covariates,
          type = "latex",   # Use "html" for HTML output or "latex" for LaTeX
          title = "Regression Results for Chameleon Score", 
          covariate.labels = c("Treatment", "log(Age)", "Gender", 
                               "Chameleon Awareness (Negative)", 
                               "Chameleon Awareness (Neutral)", 
                               "Chameleon Awareness (Positive)"),  # Manually add all factor levels
          star.cutoffs = c(0.10, 0.05, 0.01, 0.001),
          report = "vc*p")  # Optional: Save output to a text file
```


\begin{table}[!htbp] \centering 
  \caption{Regression Results for Chameleon Score} 
  \label{} 
\begin{tabular}{@{\extracolsep{5pt}}lcc} 
\\[-1.8ex]\hline 
\hline \\[-1.8ex] 
 & \multicolumn{2}{c}{\textit{Dependent variable:}} \\ 
\cline{2-3} 
\\[-1.8ex] & \multicolumn{2}{c}{chameleon\_score} \\ 
\\[-1.8ex] & (1) & (2)\\ 
\hline \\[-1.8ex] 
 Treatment & 0.410 & 0.094 \\ 
  & p = 0.242 & p = 0.777 \\ 
  & & \\ 
 log(Age) &  & 1.242$^{**}$ \\ 
  &  & p = 0.019 \\ 
  & & \\ 
 Gender &  & 0.134 \\ 
  &  & p = 0.675 \\ 
  & & \\ 
 Chameleon Awareness (Negative) &  & 1.347 \\ 
  &  & p = 0.189 \\ 
  & & \\ 
 Chameleon Awareness (Neutral) &  & 1.334$^{**}$ \\ 
  &  & p = 0.017 \\ 
  & & \\ 
 Chameleon Awareness (Positive) &  & 1.636$^{****}$ \\ 
  &  & p = 0.001 \\ 
  & & \\ 
 Constant & 3.641$^{****}$ & $-$0.935 \\ 
  & p = 0.000 & p = 0.603 \\ 
  & & \\ 
\hline \\[-1.8ex] 
Observations & 78 & 78 \\ 
R$^{2}$ & 0.018 & 0.247 \\ 
Adjusted R$^{2}$ & 0.005 & 0.184 \\ 
Residual Std. Error & 1.534 (df = 76) & 1.390 (df = 71) \\ 
F Statistic & 1.394 (df = 1; 76) & 3.885$^{***}$ (df = 6; 71) \\ 
\hline 
\hline \\[-1.8ex] 
\textit{Note:}  & \multicolumn{2}{r}{$^{*}$p$<$0.1; $^{**}$p$<$0.05; $^{***}$p$<$0.01} \\ 
\end{tabular} 
\end{table}